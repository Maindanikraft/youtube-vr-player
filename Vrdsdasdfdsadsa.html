<script>
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player1, player2;
    var isFullscreen = false;
    var syncInterval;
    var syncIntervalTime = 1000; // Check sync every 1 second
    var syncThreshold = 0.005; // Synchronization threshold in seconds

    function onYouTubeIframeAPIReady() {
        player1 = new YT.Player('video1', {
            events: {
                'onReady': onPlayerReady
            }
        });
        player2 = new YT.Player('video2', {
            events: {
                'onReady': onPlayerReady
            }
        });
    }

    function onPlayerReady(event) {
        if (player1 && player2) {
            document.getElementById('playButton').disabled = false;
        }
    }

    function loadVideo(url) {
        try {
            var videoId;
            if (url.includes('youtu.be')) {
                videoId = url.split('youtu.be/')[1];
            } else {
                videoId = new URL(url).searchParams.get('v');
            }
            if (videoId) {
                var embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1`;
                document.getElementById('video1').src = embedUrl;
                document.getElementById('video2').src = embedUrl;
            } else {
                alert('Invalid YouTube URL');
            }
        } catch (e) {
            alert('Error loading video');
        }
    }

    function playBothVideos() {
        var url = document.getElementById('urlInput').value;
        if (url && player1 && player2) {
            loadVideo(url);
            player1.playVideo();
            player2.playVideo();
            player1.unMute(); // Unmute the first video
            player2.unMute(); // Unmute the second video

            // Start synchronization check
            syncInterval = setInterval(syncVideos, syncIntervalTime);

            // Seek to 3 seconds after 4 seconds
            setTimeout(function() {
                seekToThreeSeconds();
            }, 4000);
        } else {
            alert('Please enter a valid YouTube URL');
        }
    }

    function syncVideos() {
        if (player1 && player2) {
            var time1 = player1.getCurrentTime();
            var time2 = player2.getCurrentTime();
            var diff = Math.abs(time1 - time2);

            if (diff > syncThreshold) { // If difference exceeds the sync threshold
                var targetTime = Math.min(time1, time2); // Seek to the earlier time
                player1.seekTo(targetTime, true);
                player2.seekTo(targetTime, true);
            }
        }
    }

    function seekToThreeSeconds() {
        if (player1 && player2) {
            player1.seekTo(3, true);
            player2.seekTo(3, true);
        }
    }

    document.getElementById('playButton').addEventListener('click', playBothVideos);

    document.getElementById('hideControlsButton').addEventListener('click', function() {
        var controlsContainer = document.getElementById('controlsContainer');
        controlsContainer.classList.toggle('hidden');
    });

    document.getElementById('fullscreenButton').addEventListener('click', function() {
        var body = document.body;
        if (!isFullscreen) {
            body.classList.add('fullscreen');
            isFullscreen = true;
        } else {
            body.classList.remove('fullscreen');
            isFullscreen = false;
        }
    });
</script>

